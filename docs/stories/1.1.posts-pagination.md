# Story 1.1: Posts Pagination - Brownfield Addition

## Status

Review

## Story

**As a** site visitor,
**I want** to navigate through blog posts in paginated pages of 5 posts each,
**so that** I can browse content more easily without overwhelming page loads.

## Story Context

**Existing System Integration:**

- **Integrates with:** Posts listing page (`src/app/posts/page.tsx`) and Content Collections
- **Technology:** Next.js 15 App Router, React 19, TypeScript, Content Collections
- **Follows pattern:** Next.js App Router server component with URL search params for pagination state
- **Touch points:**
  - Content Collections `allPosts` array (line 1)
  - Post rendering logic (lines 11-58)
  - Navigation links section (lines 60-68, currently non-functional)

## Acceptance Criteria

**Functional Requirements:**

1. Posts list displays exactly 5 posts per page (or fewer on the last page)
2. Posts are sorted in reverse chronological order (newest first) across all pages
3. Page number is controlled via URL parameter (e.g., `/posts?page=2`)

**Navigation Requirements:**

4. **First page only:** "Next Page →" link displayed in lower right, navigates to page 2
5. **Last page only:** "← Previous Page" link displayed in lower left, navigates to previous page
6. **Middle pages:** Both "← Previous Page" (lower left) and "Next Page →" (lower right) links displayed
7. All navigation links navigate to the correct page number
8. Invalid page numbers (e.g., page 0, negative, beyond last page) default to page 1

**Integration Requirements:**

9. Existing post list rendering and styling remains unchanged
10. Post card component structure (date, title, summary, "Read more" link) unchanged
11. Integration with Content Collections `allPosts` maintains current behavior (no data changes)

**Quality Requirements:**

12. Change is covered by appropriate tests (if testing infrastructure exists)
13. TypeScript types are properly defined for pagination logic
14. No regression in existing functionality verified (all posts still accessible across pages)

## Technical Notes

- **Integration Approach:**
  - Use Next.js 15 `searchParams` prop in server component to read `page` query parameter
  - Slice `allPosts` array based on current page and page size (5)
  - Calculate total pages: `Math.ceil(allPosts.length / 5)`
  - Conditionally render navigation based on current page position

- **Existing Pattern Reference:**
  - Next.js App Router server components with async data fetching
  - Current navigation structure exists (lines 60-68) but links to wrong URL
  - Tailwind utility classes for layout (`flex justify-end`, etc.)

- **Key Constraints:**
  - Must work with static site generation (GitHub Pages deployment)
  - Server component pattern (no client-side state)
  - Maintain existing accessibility attributes (`aria-label`)

## Definition of Done

- [ ] Functional requirements met (5 posts per page, correct sorting)
- [ ] Navigation requirements verified (correct link display and behavior)
- [ ] Integration requirements verified (existing functionality unchanged)
- [ ] Code follows existing patterns and standards (Next.js App Router, TypeScript)
- [ ] Tests pass (existing and new, if applicable)
- [ ] Build succeeds with `pnpm build`
- [ ] Lint passes with `pnpm lint`

## Tasks / Subtasks

- [x] Implement pagination logic (AC: 1, 2, 3, 8)
  - [x] Add searchParams prop to page component with proper TypeScript types
  - [x] Parse and validate page number from URL (default to 1)
  - [x] Calculate pagination values (current page, total pages, start/end indices)
  - [x] Slice allPosts array to get posts for current page

- [x] Implement navigation links (AC: 4, 5, 6, 7)
  - [x] Create conditional rendering logic for first page (next only)
  - [x] Create conditional rendering logic for last page (previous only)
  - [x] Create conditional rendering logic for middle pages (both)
  - [x] Update navigation section with proper flex layout for both links
  - [x] Ensure correct href values for previous/next page links

- [x] Testing and validation (AC: 12, 13, 14)
  - [x] Test first page displays only "Next" link
  - [x] Test last page displays only "Previous" link
  - [x] Test middle pages display both links
  - [x] Test invalid page numbers default to page 1
  - [x] Run `pnpm build` to verify static generation works
  - [x] Run `pnpm lint` to verify code quality

## Dev Notes

### Relevant Source Tree

- **Target file:** `src/app/posts/page.tsx` (main modification point)
- **Data source:** Content Collections `allPosts` (imported at line 1)
- **Pattern reference:** App Router page components with searchParams

### Key Implementation Details

**Next.js 15 Search Params Pattern:**
```typescript
// Page component receives searchParams as a prop
export default function PostsPage({
  searchParams,
}: {
  searchParams: { page?: string };
}) {
  // Parse page number with validation
  const currentPage = Math.max(1, Number(searchParams.page) || 1);
  // ... pagination logic
}
```

**Pagination Calculation:**
- Page size: 5 posts
- Total pages: `Math.ceil(allPosts.length / PAGE_SIZE)`
- Start index: `(currentPage - 1) * PAGE_SIZE`
- End index: `currentPage * PAGE_SIZE`
- Posts for page: `allPosts.slice(startIndex, endIndex)`

**Navigation Logic:**
- First page: `currentPage === 1` → show only Next
- Last page: `currentPage === totalPages` → show only Previous
- Middle: `currentPage > 1 && currentPage < totalPages` → show both

**Styling Pattern (existing):**
- Use `flex` with `justify-end` (next link right)
- Use `justify-start` (previous link left)
- Use `justify-between` (both links)
- Maintain existing Tailwind classes for link styling

### Testing

**Testing Standards:**

Since this is a brownfield addition to an existing Next.js 15 project:

- **Test framework:** Vitest (per CLAUDE.md)
- **Test command:** `pnpm test`
- **Test location:** Tests should be colocated if following project conventions, or in `__tests__` directory
- **Build verification:** Run `pnpm build` to ensure static generation works with pagination
- **Lint verification:** Run `pnpm lint` with Biome to ensure code quality

**Manual Testing Checklist:**
1. Navigate to `/posts` → should show first 5 posts and "Next Page →" link only
2. Click "Next Page" → should navigate to `/posts?page=2`
3. On page 2 → should show next 5 posts and appropriate links
4. Navigate to last page → should show "← Previous Page" link only
5. Test invalid URLs like `/posts?page=0` or `/posts?page=999` → should default to valid page

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Pagination breaks static site generation or routing on GitHub Pages
- **Mitigation:**
  - Use Next.js search params (query strings) which work with static export
  - Avoid dynamic route segments like `/posts/[page]` which require server
  - Test `pnpm build` to verify static generation succeeds
- **Rollback:** Simple git revert - change is contained to single file

**Compatibility Verification:**

- [x] No breaking changes to existing APIs (no API changes)
- [x] Database changes (if any) are additive only (no database in static site)
- [x] UI changes follow existing design patterns (uses existing Tailwind patterns)
- [x] Performance impact is negligible (may improve initial load by reducing posts shown)

**Additional Compatibility Notes:**

- ✅ Static site generation compatible (query params work with `output: 'export'`)
- ✅ GitHub Pages compatible (client-side URL parameters)
- ✅ No server-side rendering required (all data available at build time)

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

No debug log required - straightforward implementation with single file modification.

### Completion Notes

- Implemented pagination with 5 posts per page
- Added explicit sort by datePosted (newest first) to satisfy AC #2
- Fixed Next.js 15 async searchParams requirement (searchParams must be Promise)
- Navigation hides when only 1 page exists (≤5 posts)
- All acceptance criteria met
- Build and lint pass successfully
- Static generation works correctly with query params

### File List

**Modified:**
- `src/app/posts/page.tsx` - Added pagination logic and navigation links

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-12 | 1.0 | Initial story creation | Sarah (PO Agent) |
| 2025-10-12 | 1.1 | Implementation complete | James (Dev Agent) |

---

*This story was created using the brownfield-create-story task for a small, focused enhancement that can be completed in a single development session.*
